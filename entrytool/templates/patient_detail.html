{% load honeur_panels %}
{% load forms %}
<div ng-show="patient == null" class="container-fluid content-offset">
  <h1 class="text-center content-offset">
    Patient not found
  </h1>
  <p class="lead text-center content-offset">
    We're sorry but we couldn't find the patient you're looking for.
    <br />
    Perhaps try searching for them instead?
  </p>
</div>
<div class="entry-tool container-fluid content-offset {% block container_classes %}{% endblock %}"
     ng-hide="patient == null">
  <div class="panel panel-primary panel-container patient-detail {% block panel_classes %}{% endblock %}">
    <!-- Default panel contents -->
    <div class="panel-heading patient-detail-heading">
      <h2>
        {% block heading %}Patient [[ patient.id ]]{% endblock %}
      </h2>
    </div>

    <div class="panel-body {% block panel_body_classes %}{% endblock %}">
      <div ng-controller="PatientValidator"></div>
      <div class="row">
        {% block content %}
          <div class="col-md-12 padding0">
            <div class="row">
              <div class="col-md-12">
                {% include "detail/default.html" %}
              </div>
            </div>

            <section ng-show="patient.patient_details[0].consistency_token"> <!-- Treatment lines, follow ups -->
              <div class="panel mb6">
                <div class="panel-heading" >
                  <h3>
                    Lines Of Treatment
                    <span class="pull-right pointer edit" ng-controller="LineOfTreatmentCreator as lineOfTreatmentCreator">
                      <a ng-click="lineOfTreatmentCreator.canEdit() && lineOfTreatmentCreator.create(patient)">
                        <i class="fa fa-plus-circle edit pointer"></i>
                      </a>
                    </span>
                  </h3>
                </div>
              </div>

              <div class="row" ng-repeat="episode in patient.episodes | filter: { category_name: 'Treatment Line' } | orderBy: '-id' as lot_episodes">
                <div class="col-md-12 inline-panels">
                  {% include "detail/treatmentline.html" %}
                </div>
              </div>

              <div class="panel mb6">
                <div class="panel-heading">
                  <h3>
                    Follow Ups
                    <span class="pull-right pointer edit">
                      <a ng-click="episode.recordEditor.newItem('{{ models.FollowUp.get_api_name }}')">
                        <i class="fa fa-plus-circle edit pointer"></i>
                      </a>
                    </span>
                  </h3>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                  {% include "detail/followups.html" %}
                </div>
              </div>


            </section>

          </div>
        {% endblock content %}
      </div>

    </div> <!-- Panel body -->

  </div>   <!-- Panel -->
</div>     <!-- Container -->
