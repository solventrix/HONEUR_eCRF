{% load forms %}
{% load i18n admin_urls %}
<div class="form-group" {% if visibility %} {{ visibility|safe }} {% endif %} >
  <span
    {% if validator %}
    ng-class="{'has-error': {{ formname }}.$submitted && (form[{{ element_name }}].$invalid || $root.patientValidator.errors.{{ validator }})}"
    {% else %}
    ng-class="{ 'errored-state': {{ formname }}[{{ element_name }}].$dirty && !{{ formname }}[{{ element_name }}].$valid }"
    {% endif %}
  >
    {% if label %}
    <label class="control-label {% ifequal style "horizontal" %}col-sm-3{% endifequal %}">
      {{ label }}
    </label>
    {% endif %}
    <div class="{% ifequal style "horizontal" %}col-sm-8{% endifequal %}"
         ng-class='{"has-error": {{ formname }}.$submitted && {{ formname }}[{{ element_name }}].$error.required}'>
      <select {% if autofocus %}autofocus {% endif %}name="[[ {{ element_name }} ]]" {% if required %}required{% endif %} class="form-control" ng-model="{{ model }}"
        {% if change %}
        ng-change="{{ change }}"
        {% elif validator %}
        ng-change="$root.patientValidator.{{ validator }}({{ model }}, {{ model_name }}, the_episode)"
        {% endif %}
        {% if disabled %}ng-disabled="{{ disabled }}" {% endif %} {% for d in directives %}{{ d }} {% endfor %}>
        {% if default_null %}
        <option value="" selected>---------</option>
        {% endif %}
        <option value="[[ i ]]" ng-repeat="i in {{ lookuplist }} track by $index">[[ i | translate ]]</option>
      </select>
    {% if required %}
      <span ng-show="{{ formname }}.$submitted && {{ formname }}[{{ element_name }}].$error.required" class="help-block">
        {% blocktrans with label=label %}{{ label }} is required{% endblocktrans %}
      </span>
    {% endif %}
    {% if validator %}
    <span
       class="help-block" ng-show="form.$submitted && $root.patientValidator.errors.{{ validator }}"
       >
         [[ $root.patientValidator.errors.{{ validator }} ]]
       </span>
       <span
       class="warning-block" ng-show="$root.patientValidator.warnings.{{ validator }}"
     >
       [[ $root.patientValidator.warnings.{{ validator }} ]]
     </span>
     {% endif %}
    {% if help_text %}
      <p class="help-block">{% trans help_text %}</p>
    {% endif %}
    {% if include_admin_link %}
      {% if user.is_superuser or user.is_staff %}
      <p class="help-block">
        {% blocktrans %}
          If the option is not present, you can add it <a href="{{ admin_url }}">here</a>
        {% endblocktrans %}
      </p>
      {% endif %}
    {% endif %}
    </div>
  </span>
</div>


{% load forms %}
{% load i18n %}
<div class="form-group" {% if visibility %} {{ visibility|safe }} {% endif %} >
  <span ng-class="{'has-error': $root.patientValidator.showErrors('{{ field_name }}')}">
    {% if label %}
    <label class="control-label {% ifequal style "horizontal" %}col-sm-3{% endifequal %}">
      {{ label }}
    </label>
    {% endif %}
    <div class="{% ifequal style "horizontal" %}col-sm-8{% endifequal %}">
      <select {% if autofocus %}autofocus {% endif %}name="[[ {{ element_name }} ]]" class="form-control" ng-model="{{ model }}" ng-change="$root.patientValidator.validatesubrecord('{{ model_api_name }}', {{ subrecord }}, the_episode)">
        {% if default_null %}
        <option value="" selected>---------</option>
        {% endif %}
        <option value="[[ i ]]" ng-repeat="i in {{ lookuplist }} track by $index">[[ i | translate ]]</option>
      </select>
      <span
      class="warning-block" ng-show="$root.patientValidator.showWarnings('{{ field_name }}') && !$root.patientValidator.showErrors('{{ field_name }}')"
    >
      <div ng-repeat="warning in $root.patientValidator.warnings['{{ field_name }}'] track by $index">
         [[ warning ]]
      </div>
    </span>
    <span
    class="help-block" ng-show="$root.patientValidator.showErrors('{{ field_name }}')"
    >
     <div ng-repeat="error in $root.patientValidator.errors['{{ field_name }}'] track by $index">
       [[ error ]]
     </div>
    </span>
      {% if help_text %}
      <p ng-show="!$root.patientValidator.showErrors('{{ field_name }}')" class="help-block">
        {% trans help_text %}
      </p>
    {% endif %}
    {% if include_admin_link %}
      {% if user.is_superuser or user.is_staff %}
      <p class="help-block">
        {% blocktrans %}
          If the option is not present, you can add it <a href="{{ admin_url }}">here</a>
        {% endblocktrans %}
      </p>
      {% endif %}
    {% endif %}
    </div>
  </span>
</div>
